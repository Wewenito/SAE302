<!doctype html>
<html class="no-js" lang="fr" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Recherche" href="../search.html" />

    <!-- Generated with Sphinx 7.2.5 and Furo 2023.09.10 -->
        <title>client - Documentation CLIENT 1.0 26-12-2023</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Documentation CLIENT 1.0 26-12-2023</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Documentation CLIENT 1.0 26-12-2023</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Recherche" name="q" aria-label="Recherche">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../client.html">Client Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main.html">Main Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../popup.html">Popup Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sys_x.html">Sys_x Module</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Code source de client</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">sys_x</span> <span class="kn">import</span> <span class="bp">cls</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">PyQt6.QtWidgets</span> <span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QGridLayout</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QColumnView</span><span class="p">,</span> <span class="n">QTextEdit</span><span class="p">,</span> <span class="n">QStatusBar</span><span class="p">,</span> <span class="n">QMenuBar</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span> <span class="n">QScrollArea</span>
<span class="kn">from</span> <span class="nn">PyQt6.QtCore</span> <span class="kn">import</span> <span class="n">QCoreApplication</span><span class="p">,</span> <span class="n">QRect</span><span class="p">,</span> <span class="n">QFile</span><span class="p">,</span> <span class="n">QTextStream</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">pyqtSignal</span><span class="p">,</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">PyQt6</span> <span class="kn">import</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">popup</span> <span class="kn">import</span> <span class="n">Manage_rooms</span><span class="p">,</span> <span class="n">Manage_demands</span><span class="p">,</span> <span class="n">Manage_friends</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>


<div class="viewcode-block" id="Client_handle">
<a class="viewcode-back" href="../client.html#client.Client_handle">[docs]</a>
<span class="k">class</span> <span class="nc">Client_handle</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ceci est la classe principale pour les clients.</span>
<span class="sd">    Celle-ci génère aussi bien la partie authentification de l&#39;UI et les processus qui y sont associés</span>
<span class="sd">    mais également la génération de la fenêtre principale permettant à l&#39;utilisateur d&#39;interargir avec l&#39;application.</span>

<span class="sd">    :param QMainWindow: Objet PyQt6 décrivant cette classe comme étant la fenêtre principale de l&#39;application.</span>
<span class="sd">    :type QMainWindow: object</span>

<span class="sd">    :ivar client_socket: Object socket lié au serveur afin de communiquer avec celui-ci.</span>
<span class="sd">    :vartype client_socket: object</span>

<span class="sd">    :ivar logged_in: Le client est-il authentifié auprès du serveur.</span>
<span class="sd">    :vartype logged_in: bool</span>

<span class="sd">    :ivar user_data: Contient les informations de l&#39;utilisateur une fois celui-ci connecté :</span>
<span class="sd">        - **&#39;id&#39; (int):** ID Utilisateur</span>
<span class="sd">        - **&#39;Username&#39; (str):** Nom d&#39;utilisateur</span>
<span class="sd">        - **&#39;First_name&#39; (str):** Prénom de l&#39;utilisateur</span>
<span class="sd">        - **&#39;Last_name&#39; (str):** Nom de l&#39;utilisateur</span>
<span class="sd">        - **&#39;Password&#39; (str):** Mot de passe de l&#39;utilisateur</span>
<span class="sd">        - **&#39;Mail&#39; (str):** Mail de l&#39;utilisateur</span>
<span class="sd">        - **&#39;User_type&#39; (str):** Type d&#39;utilisateur (EMPLOYE / ADMIN)</span>
<span class="sd">        - **&#39;is_banned&#39; (bool):** Utilisateur banni ou non</span>
<span class="sd">        - **&#39;is_connected&#39; (str):** Utilisateur connecté ou non</span>
<span class="sd">    :vartype user_data: dictionnary</span>

<span class="sd">    :ivar user_friends: Contient les amis de l&#39;utilisateur, format -&gt; [UID ami, nom ami, statut]</span>
<span class="sd">    :vartype user_friends: array</span>

<span class="sd">    :ivar user_rooms: Contient les salons connus de l&#39;utilisateur.</span>
<span class="sd">    :vartype user_rooms: array</span>

<span class="sd">    :ivar user_rooms_rights: Contient les droits d&#39;accès de l&#39;utilisateur aux salons connus</span>
<span class="sd">    :vartype user_rooms_rights: array</span>

<span class="sd">    :ivar current_room: Salon actuel ou se trouve l&#39;utilisateur</span>
<span class="sd">    :vartype current_room: array</span>

<span class="sd">    :ivar current_room_rights: Droits du salon ou se trouve l&#39;utilisateur</span>
<span class="sd">    :vartype current_room_rights: array</span>

<span class="sd">    :ivar listener_for_message_input: Variable permettant de savoir si on écoute actuellement l&#39;arrivée de nouveaux messages sur un salon.</span>
<span class="sd">    :vartype listener_for_message_input: bool</span>

<span class="sd">    :ivar private_listener_for_message_input: Variable permettant de savoir si on écoute actuellement l&#39;arrivée de nouveaux messages sur une discussion privée</span>
<span class="sd">    :vartype private_listener_for_message_input: bool</span>

<span class="sd">    :ivar ui: Cette variable est utilisée pour associer une fenêtre &#39;popup&#39; à la fenêtre principale et intérargir avec.</span>
<span class="sd">    :vartype ui: object</span>

<span class="sd">    :ivar demands: Ce tableau contient les demandes actuelles de l&#39;utilisateur pour rejoindre un ou plusieurs salons.</span>
<span class="sd">    :vartype demands: array</span>

<span class="sd">    :ivar ui_operation_signal: Objet permettant la reception / envoi de signaux pour gérer l&#39;UI de cette fenêtre.</span>
<span class="sd">    :vartype ui_operation_signal: PyQt Object</span>

<span class="sd">    :return: Un object client complet permettant la gestion des intéractions de l&#39;utilisateur avec l&#39;application.</span>
<span class="sd">    :rtype: object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ui_operation_signal</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#this variable sets to True once client is logged in to the server. use this to prevent actions in case user is not logged.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#contains [friend_uid, friend_name, status]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_room</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_room_rights</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listener_for_message_input</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">private_listener_for_message_input</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demands</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;LOGIN&quot;</span><span class="p">)</span>  <span class="c1"># Set the initial window name</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="mi">11111</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle INIT connected to server]&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle INIT ERROR while connecting to server]&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please make sure the server is up and running, and on the same subnetwork as you.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_login_ui</span><span class="p">()</span>

        <span class="n">style_file</span> <span class="o">=</span> <span class="n">QFile</span><span class="p">(</span><span class="s2">&quot;styles.css&quot;</span><span class="p">)</span>
        <span class="n">style_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">QFile</span><span class="o">.</span><span class="n">OpenModeFlag</span><span class="o">.</span><span class="n">ReadOnly</span> <span class="o">|</span> <span class="n">QFile</span><span class="o">.</span><span class="n">OpenModeFlag</span><span class="o">.</span><span class="n">Text</span><span class="p">)</span>
        <span class="n">stylesheet</span> <span class="o">=</span> <span class="n">QTextStream</span><span class="p">(</span><span class="n">style_file</span><span class="p">)</span><span class="o">.</span><span class="n">readAll</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">stylesheet</span><span class="p">)</span>

<div class="viewcode-block" id="Client_handle.connect_to_server">
<a class="viewcode-back" href="../client.html#client.Client_handle.connect_to_server">[docs]</a>
    <span class="k">def</span> <span class="nf">connect_to_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_IP</span><span class="p">,</span> <span class="n">server_PORT</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Methode pour se connecter au serveur.</span>

<span class="sd">        :param server_IP: Adresse IP du serveur.</span>
<span class="sd">        :type server_IP: str</span>

<span class="sd">        :param server_PORT: Port du serveur.</span>
<span class="sd">        :type server_IP: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">server_IP</span><span class="p">,</span> <span class="n">server_PORT</span><span class="p">))</span></div>


<div class="viewcode-block" id="Client_handle.send_message_server">
<a class="viewcode-back" href="../client.html#client.Client_handle.send_message_server">[docs]</a>
    <span class="k">def</span> <span class="nf">send_message_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Permet d&#39;envoyer un message au serveur</span>

<span class="sd">        :param message: Message à envoyer</span>
<span class="sd">        :type message: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span></div>


<div class="viewcode-block" id="Client_handle.close_application">
<a class="viewcode-back" href="../client.html#client.Client_handle.close_application">[docs]</a>
    <span class="k">def</span> <span class="nf">close_application</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ferme l&#39;UI du client.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span></div>


<div class="viewcode-block" id="Client_handle.terminate_client">
<a class="viewcode-back" href="../client.html#client.Client_handle.terminate_client">[docs]</a>
    <span class="k">def</span> <span class="nf">terminate_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ferme le socket de connection au serveur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add any cleanup or termination logic here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Forcefully exit the client process</span></div>


<div class="viewcode-block" id="Client_handle.On_log_user_click">
<a class="viewcode-back" href="../client.html#client.Client_handle.On_log_user_click">[docs]</a>
    <span class="k">def</span> <span class="nf">On_log_user_click</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode gère les actions à éxecuter lorsque le client clique sur le bouton &#39;login&#39; de l&#39;UI.</span>

<span class="sd">        :raises BrokenPipeError: Si le serveur n&#39;est plus joignable / disponible</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_message_server</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listen_server_messages_login_register</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">BrokenPipeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BROCKEN PIPE ERROR, SERVER TURNED OFF, QUITTING.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span></div>


<div class="viewcode-block" id="Client_handle.On_reg_user_click">
<a class="viewcode-back" href="../client.html#client.Client_handle.On_reg_user_click">[docs]</a>
    <span class="k">def</span> <span class="nf">On_reg_user_click</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode gère les actions à éxecuter lorsque le client clique sur le bouton &#39;register&#39; de l&#39;UI.</span>

<span class="sd">        :raises BrokenPipeError: Si le serveur n&#39;est plus joignable / disponible</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_message_server</span><span class="p">(</span><span class="s2">&quot;/register&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listen_server_messages_login_register</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">BrokenPipeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BROCKEN PIPE ERROR, SERVER TURNED OFF, QUITTING.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span></div>

        
<div class="viewcode-block" id="Client_handle.login_process">
<a class="viewcode-back" href="../client.html#client.Client_handle.login_process">[docs]</a>
    <span class="k">def</span> <span class="nf">login_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processus principal de login, celui-ci inclue une boucle qui tourne indéfiniment tant que le client n&#39;est pas connecté.</span>

<span class="sd">        :ivar credentials_username: Nom d&#39;utilisateur entré au sein de l&#39;UI</span>
<span class="sd">        :vartype credentials_username: str</span>

<span class="sd">        :ivar credentials_password: Mot de passe entré au sein de l&#39;UI</span>
<span class="sd">        :vartype credentials_password: str</span>

<span class="sd">        .. admonition:: Conditions</span>

<span class="sd">            - Si le nom d&#39;utilisateur et le mot de passe sont correct -&gt; on valide l&#39;authentification, on récupère également les infos utilisateur, salons et droits des dit-salons.</span>
<span class="sd">            - Si l&#39;utilisateur n&#39;existe pas, on renvoie un message d&#39;erreur et recommence le processus.</span>
<span class="sd">            - Si le mot de passe est érroné, on renvoie un message d&#39;erreur et recommence le processus.</span>
<span class="sd">            - Si l&#39;utilisateur est banni, on renvoie un message d&#39;erreur et le processus se termine étant donné que l&#39;adresse IP est bannie.</span>
<span class="sd">            - Si l&#39;utilisateur est kick, on renvoie un message d&#39;erreur et on ferme l&#39;application également.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        :return: Envoi d&#39;un signal de succès à l&#39;UI pour générer la page principale.</span>
<span class="sd">        :rtype: signal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle login_process starts]&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">credentials_username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">username_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">credentials_password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">password_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="n">user_data</span> <span class="o">=</span> <span class="n">credentials_username</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="n">credentials_password</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">user_data</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

            <span class="n">server_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">server_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LOGIN_PROCESS_STEP_2_OK&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SERVER RESPONSE WITH DATA : </span><span class="si">{</span><span class="n">server_response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1">#Here we take the 2nd part of the server response and</span>
                <span class="c1">#update our user_data dictionnary.</span>
                <span class="n">response_user_data</span> <span class="o">=</span> <span class="n">server_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">user_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">response_user_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;Username&quot;</span><span class="p">:</span> <span class="n">response_user_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;First_name&quot;</span><span class="p">:</span> <span class="n">response_user_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="s2">&quot;Last_name&quot;</span><span class="p">:</span> <span class="n">response_user_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="s2">&quot;Password&quot;</span><span class="p">:</span> <span class="n">response_user_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">],</span>
                    <span class="s2">&quot;Mail&quot;</span><span class="p">:</span> <span class="n">response_user_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">5</span><span class="p">],</span>
                    <span class="s2">&quot;User_type&quot;</span><span class="p">:</span> <span class="n">response_user_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">6</span><span class="p">],</span>
                    <span class="s2">&quot;is_banned&quot;</span><span class="p">:</span> <span class="n">response_user_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">7</span><span class="p">],</span>
                    <span class="s2">&quot;is_connected&quot;</span><span class="p">:</span> <span class="n">response_user_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">8</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="n">user_data</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arranged user_data sent from server = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


                <span class="c1">#Here we take the 3rd part of the server response and</span>
                <span class="c1">#update the user&#39;s friends</span>
                <span class="n">user_friends</span> <span class="o">=</span> <span class="n">server_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">users</span> <span class="ow">in</span> <span class="n">user_friends</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Users : </span><span class="si">{</span><span class="n">users</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">users</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">friend_uid</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">friend_username</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">friend_status</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">friend_uid</span><span class="p">,</span> <span class="n">friend_username</span><span class="p">,</span> <span class="n">friend_status</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;friends of the user : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


                <span class="c1">#here we take the 4th part of the server response and</span>
                <span class="c1">#update the user&#39;s rooms available</span>
                <span class="n">rooms_available</span> <span class="o">=</span> <span class="n">server_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">room</span> <span class="ow">in</span> <span class="n">rooms_available</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">room</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">room</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">room</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">room</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rooms known to the user : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                

                <span class="n">rooms_rights</span> <span class="o">=</span> <span class="n">server_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">room_right</span> <span class="ow">in</span> <span class="n">rooms_rights</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">room_right</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">room_right</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">room_right</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">room_right</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">room_right</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]])</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rooms rights for the user : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1">#Now we tell the server that the procedure is all done.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;LOGIN_ACK_DONE&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle login_process ends]&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;login success&quot;</span><span class="p">)</span>
                <span class="k">break</span>  <span class="c1"># Exit the loop after successful login</span>
            <span class="k">elif</span> <span class="n">server_response</span> <span class="o">==</span> <span class="s2">&quot;LOGIN_PROCESS_STEP_2|NOK|USER_DOES_NOT_EXIST&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;WRONG USER&quot;</span><span class="p">,</span> <span class="s2">&quot;This user does not exist. </span><span class="se">\n\n</span><span class="s2">Please type in the infos again.</span><span class="se">\n\n</span><span class="s2">Make sure you are entering the right Username&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle login_process ends]&quot;</span><span class="p">)</span>
                <span class="k">break</span>
                <span class="c1"># here send the user back to login asking for creds</span>
            <span class="k">elif</span> <span class="n">server_response</span> <span class="o">==</span> <span class="s2">&quot;LOGIN_PROCESS_STEP_2|NOK|WRONG_PASSWORD&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;WRONG PASSWORD&quot;</span><span class="p">,</span> <span class="s2">&quot;The password given is not right. </span><span class="se">\n\n</span><span class="s2">Please try again.&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle login_process ends]&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">server_response</span> <span class="o">==</span> <span class="s2">&quot;LOGIN_PROCESS_STEP_2_USER_BANNED&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;YOU ARE BANNED&quot;</span><span class="p">,</span> <span class="s2">&quot;We cannot log you in because you have been banned from this server.</span><span class="se">\n\n</span><span class="s2">The application will now close.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span>
                
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle login_process ends]&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">server_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LOGIN_PROCESS_STEP_2_USER_KICKED&quot;</span><span class="p">:</span>
                <span class="n">ok_date</span> <span class="o">=</span> <span class="n">server_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;YOU ARE KICKED&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;We cannot log you in because you have been kicked temporarely from this server.</span><span class="se">\n\n</span><span class="s2">You can reconnect on the : </span><span class="si">{</span><span class="n">ok_date</span><span class="si">}</span><span class="s2"> </span><span class="se">\n\n</span><span class="s2">The application will now close.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="Client_handle.register_process">
<a class="viewcode-back" href="../client.html#client.Client_handle.register_process">[docs]</a>
    <span class="k">def</span> <span class="nf">register_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processus principal d&#39;inscription, celui-ci inclue une boucle qui tourne indéfiniment tant que le compte du client n&#39;a pas été correctement créé.</span>
<span class="sd">        </span>
<span class="sd">        :ivar credentials_username: Nom d&#39;utilisateur entré par l&#39;utilisateur</span>
<span class="sd">        :vartype credentials_username: str</span>

<span class="sd">        :ivar credentials_firstname: Prénom entré par l&#39;utilisateur</span>
<span class="sd">        :vartype credentials_firstname: str</span>

<span class="sd">        :ivar credentials_lastname: Nom entré par l&#39;utilisateur</span>
<span class="sd">        :vartype credentials_lastname: str</span>

<span class="sd">        :ivar credentials_password: Mot de passe entré par l&#39;utilisateur</span>
<span class="sd">        :vartype credentials_password: str</span>

<span class="sd">        :ivar credentials_confirmpassword: Confirmation de MdP entré par l&#39;utilisateur</span>
<span class="sd">        :vartype credentials_confirmpassword: str</span>

<span class="sd">        :ivar credentials_mail: Adresse mail entré par l&#39;utilisateur</span>
<span class="sd">        :vartype credentials_mail: str</span>

<span class="sd">        .. admonition:: Conditions</span>

<span class="sd">            - Si les informations d&#39;utilisateur entrées sont correct -&gt; on créé l&#39;utilisateur en envoyant les informations au serveur.</span>
<span class="sd">            - Si le nom d&#39;utilisateur est déjà utilisé -&gt; on renvoie un message d&#39;erreur et recommence la procédure.</span>
<span class="sd">            - Si l&#39;adresse IP du client est bannie -&gt; on refuse la création de l&#39;utilisateur et on ferme l&#39;application.</span>
<span class="sd">            - Si le nom d&#39;utilisateur n&#39;est pas valide, on renvoie un message d&#39;erreur et recommence la procédure.</span>
<span class="sd">            - Si les deux mot de passe ne correspondent pas, on renvoie un message d&#39;erreur et recommence la procedure.</span>

<span class="sd">            </span>
<span class="sd">        :return: Envoi d&#39;un signal du succès à l&#39;UI pour générer la page principale.</span>
<span class="sd">        :rtype: signal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle register_process starts]&quot;</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">verif_new_user_validity</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Fonction imbriquée vérifiant la validité des informations utilisateur.</span>

<span class="sd">            :param data: Données utilisateur.</span>
<span class="sd">            :type data: dictionnary</span>

<span class="sd">            :return: Si les informations sont cohérentes ou non.</span>
<span class="sd">            :rtype: str</span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="k">def</span> <span class="nf">has_forbidden_characters</span><span class="p">(</span><span class="n">input_string</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Verifie si un string contient certains caracteres.</span>

<span class="sd">                :param input_string: Valeur à analyser</span>
<span class="sd">                :type input_string: str</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">char</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;§&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">}</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">input_string</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;confirmpassword&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="s2">&quot;passwords_dont_match&quot;</span>
            <span class="k">elif</span> <span class="n">has_forbidden_characters</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]):</span>
                <span class="k">return</span> <span class="s2">&quot;unauthorized_caracters_in_username&quot;</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="k">return</span> <span class="s2">&quot;ok&quot;</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loop register process&quot;</span><span class="p">)</span>

            <span class="n">credentials_username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">username_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">credentials_firstname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstname_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">credentials_lastname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastname_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">credentials_password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">password_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">credentials_confirmpassword</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirmpassword_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">credentials_mail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mail_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="n">user_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">credentials_username</span><span class="p">,</span>
                <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="n">credentials_firstname</span><span class="p">,</span>
                <span class="s2">&quot;lastname&quot;</span><span class="p">:</span> <span class="n">credentials_lastname</span><span class="p">,</span>
                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">credentials_password</span><span class="p">,</span>
                <span class="s2">&quot;confirmpassword&quot;</span><span class="p">:</span> <span class="n">credentials_confirmpassword</span><span class="p">,</span>
                <span class="s2">&quot;mail&quot;</span><span class="p">:</span> <span class="n">credentials_mail</span>
            <span class="p">}</span>

            <span class="n">check</span> <span class="o">=</span> <span class="n">verif_new_user_validity</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
                <span class="c1">#carry on to send the user_data to the server</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User data valid on client-side, sending-it to the server.&quot;</span><span class="p">)</span>

                <span class="n">user_data_packet</span> <span class="o">=</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;firstname&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;lastname&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="n">user_data</span><span class="p">[</span><span class="s2">&quot;mail&quot;</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">user_data_packet</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

                <span class="n">server_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">server_response</span> <span class="o">==</span> <span class="s2">&quot;REGISTER_PROCESS_STEP_2|NOK|USER_ALREADY_EXISTS&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This username is already taken, you need to choose another one..</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;This username is already taken, you need to choose another one..&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_message</span><span class="p">)</span>

                    <span class="n">dlg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;USER ALREADY EXISTS&quot;</span><span class="p">)</span>
                    <span class="c1"># dlg.setIcon(QMessageBox.warning)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;This username is already taken, please choose another one.&quot;</span><span class="p">)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle register_process stops]&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">server_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;REGISTER_PROCESS_STEP_2_OK&quot;</span><span class="p">:</span><span class="c1">#IF SERVER CREATED SUCCESFULLY THE USER</span>
                    <span class="c1">#Here we update the user data now that the server has created it.</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">server_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="s2">&quot;Username&quot;</span><span class="p">:</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;First_name&quot;</span><span class="p">:</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;firstname&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;Last_name&quot;</span><span class="p">:</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;lastname&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;Password&quot;</span><span class="p">:</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;Mail&quot;</span><span class="p">:</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;mail&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;User_type&quot;</span><span class="p">:</span> <span class="s2">&quot;EMPLOYE&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;is_banned&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s2">&quot;is_connected&quot;</span><span class="p">:</span> <span class="s2">&quot;UNDEFINED&quot;</span><span class="p">,</span>
                    <span class="p">}</span>

                    <span class="c1">#Here we update the rooms available sent from the server : </span>
                    
                    <span class="n">user_rooms</span> <span class="o">=</span> <span class="n">server_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">room</span> <span class="ow">in</span> <span class="n">user_rooms</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">room</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">room</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">room</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">room</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">room</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]])</span>

                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rooms available to the user : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1">#Here we set the default rights to the rooms for a new user</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;YES_IF_ASK&#39;</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;NO&#39;</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;NO&#39;</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;NO&#39;</span><span class="p">]]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;REGISTER_ACK_DONE&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle register_process ends]&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;register success&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">server_response</span> <span class="o">==</span> <span class="s2">&quot;REGISTER_PROCESS_STEP_2|NOK|IP_IS_BANNED&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;THIS COMPUTER IS BANNED&quot;</span><span class="p">,</span> <span class="s2">&quot;This computer has the ip adress of a banned user. </span><span class="se">\n\n</span><span class="s2">Therefore you will not be allowed to recreate an account here.</span><span class="se">\n\n</span><span class="s2">Please see your admin for more informations.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle register_process stops]&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;server response : </span><span class="si">{</span><span class="n">server_response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">elif</span> <span class="n">check</span> <span class="o">==</span> <span class="s2">&quot;unauthorized_caracters_in_username&quot;</span><span class="p">:</span>
                <span class="bp">cls</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The username cannot contain special caracters or spaces.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;The username cannot contain any special caracters or spaces !&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_message</span><span class="p">)</span>

                <span class="n">dlg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;UNAUTHORISED USERNAME !&quot;</span><span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;The username cannot contain any special caracters or spaces !</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">cls</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The two passwords are not the same, please correct it.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;The two passwords are not the same, please correct it.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_message</span><span class="p">)</span>

                <span class="n">dlg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;PASSWORDS DO NOT MATCH !&quot;</span><span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;The two passwords given do not match, please verify the data entered.&quot;</span><span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                <span class="k">break</span></div>


<div class="viewcode-block" id="Client_handle.listen_server_messages_login_register">
<a class="viewcode-back" href="../client.html#client.Client_handle.listen_server_messages_login_register">[docs]</a>
    <span class="k">def</span> <span class="nf">listen_server_messages_login_register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette methode est responsable d&#39;ecouter les messages en provenance du serveur pendant tout la séquence d&#39;authentification (login &amp; register).</span>
<span class="sd">        Il est à noté que cette methode est asynchrone et ne bloque donc pas les autres interactions du script.</span>
<span class="sd">        Egalement, tant que le client n&#39;est pas connecté, cette méthode reste active (hors erreur levée).</span>

<span class="sd">        :ivar message: Message reçu par le serveur.</span>
<span class="sd">        :vartype message: str</span>

<span class="sd">        .. admonition:: Messages recevables</span>

<span class="sd">            - Le serveur accepte le départ de procédure pour se connecter.</span>
<span class="sd">            - Le serveur accepte le départ de procédure pour s&#39;enregistrer.</span>
<span class="sd">            - Si le serveur ne répond pas à la demande, celui-ci est déconnecté.</span>
<span class="sd">            - Sinon, on affiche le message dans la console.</span>


<span class="sd">        :raises Exception: Un comportement imprévu, on coupe le processus d&#39;authentification.</span>

<span class="sd">        :return: Démarrage du processus associé à la réponse du serveur.</span>
<span class="sd">        :rtype: Méthode </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server_messages_login_register starts]&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loop listen_server_messages_login_register&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message from server : </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;INIT_LOGIN_PROCESS&quot;</span> <span class="ow">or</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;LOGIN_PROCESS|OK_FOR_RETRY&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">login_process</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server_messages_login_register ends]&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;INIT_REGISTER_PROCESS&quot;</span> <span class="ow">or</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;REGISTER_PROCESS|OK_FOR_RETRY&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">register_process</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server_messages_login_register ends]&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">message</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server has been disconnected. Please ask your local admin for more informations.&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server_messages_login_register ends]&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message from server: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   &gt; &#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server_messages_login_register ends]&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span></div>


<div class="viewcode-block" id="Client_handle.listen_server">
<a class="viewcode-back" href="../client.html#client.Client_handle.listen_server">[docs]</a>
    <span class="k">def</span> <span class="nf">listen_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="c1">#SECONDARY THREAD TO LISTEN TO SERVER (CANT ALTER UI HERE)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode est l&#39;un des deux threads principaux du programme.</span>
<span class="sd">        Celle-ci s&#39;occupe de gérer les actions à executer en fonction d&#39;un message X.</span>
<span class="sd">        Ceci permet notamment la mise à jour d&#39;informations sur l&#39;UI, le lancement de nouveaux processus et autre.</span>

<span class="sd">        :ivar message: Message reçu du serveur</span>
<span class="sd">        :vartype message: str</span>

<span class="sd">        :raises Exception: Arret de la boucle en cas de problème dans l&#39;éxecution du programme</span>
<span class="sd">        :raises NoMessage: Si le message est vide, le serveur à été déconnecté, on termine alors tout les processus.</span>

<span class="sd">        .. admonition:: Action à executer en fonction du message</span>

<span class="sd">            - [READY_FOR_ROOM_DATA] -&gt; Charge les messages d&#39;un salon</span>
<span class="sd">            - [READY_FOR_PRIVATE_DATA] -&gt; Charge les messages d&#39;une discussion privée</span>
<span class="sd">            - [NEW_MESSAGE_ROOM] -&gt; Nouveau message dans le salon actuel d&#39;un utilisateur</span>
<span class="sd">            - [QUERY_ROOM_RIGHTS] -&gt; Gère les changements de droit à un salon.</span>
<span class="sd">            - [READY_FOR_PENDING_REQUESTS] -&gt; Récupération &amp; affichage des demandes d&#39;accès à un ou plusieurs salons.</span>
<span class="sd">            - [CHANGING_ROOM_RIGHTS] -&gt; Gère les demandes d&#39;utilisateurs pour rejoindre un salon aux admins et rechargement de la page de gestion de ces demandes.</span>
<span class="sd">            - [YOU_ARE_NOW_BANNED] -&gt; Gère la déconnexion d&#39;un utilisateur si celui-ci à été banni</span>
<span class="sd">            - [SERVER_IS_TURNING_OFF] -&gt; Gère la fermeture de l&#39;application en cas de coupure du serveur.</span>
<span class="sd">            - [YOU_ARE_NOW_KICKED] -&gt; Gère la déconnexion d&#39;un utilisateur si celui-ci à été banni temporairement.</span>
<span class="sd">            - [NEW_PRIVATE_MESSAGE] -&gt; Nouveau message dans la discussion privée actuelle de l&#39;utilisateur.</span>
<span class="sd">            - [FRIEND_REQUEST] -&gt; Gestion des demandes d&#39;amitiés des utilisateurs.</span>
<span class="sd">            - [UPDATE_FRIEND] -&gt; Mise à jour des listes d&#39;amis de l&#39;utilisateur.</span>

<span class="sd">        :return: Execute l&#39;action / les actions relatives au message reçu du serveur.</span>
<span class="sd">        :rtype: Méthode</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server starts]&quot;</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message received from server : </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The connection to the server has been lost.</span><span class="se">\n</span><span class="s2">Please ask your local admin for more informations.&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;SERVER DISCONNECTED&quot;</span><span class="p">,</span> <span class="s2">&quot;The connection to the server has been lost.</span><span class="se">\n</span><span class="s2">Please ask your local admin for more informations.&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server ends]&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;READY_FOR_ROOM_DATA&quot;</span><span class="p">:</span>
                    <span class="c1">#Might need to make this function a thread, this would allow other incoming traffic to be processed. tbd</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;OK_FOR_RECEIVING&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">single_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received one mess from a room : </span><span class="si">{</span><span class="n">single_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">append_message_to_room</span><span class="p">(</span><span class="n">single_message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;OK_FOR_THE_REST&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;READY_FOR_PRIVATE_DATA&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;OK_FOR_RECEIVING&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">single_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received single private message : </span><span class="si">{</span><span class="n">single_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">append_message_to_room</span><span class="p">(</span><span class="n">single_message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;OK_FOR_THE_REST&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NEW_MESSAGE_ROOM&quot;</span><span class="p">:</span>
                    <span class="n">Room_id</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">Username</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">Message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_room</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_room</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">Room_id</span><span class="p">):</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding a new message to the room this client is currently in&quot;</span><span class="p">)</span>
                            <span class="n">formatted_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">Username</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">formatted_time</span><span class="si">}</span><span class="s2">] -&gt; </span><span class="si">{</span><span class="n">Message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">scroll_bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span>
                            <span class="n">scroll_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">scroll_bar</span><span class="o">.</span><span class="n">maximum</span><span class="p">())</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New message received for a room but not the one we&#39;re in. </span><span class="se">\n</span><span class="s2">Discarding&quot;</span><span class="p">)</span>
                            <span class="k">pass</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="c1">#this exception is here in case the current room is not private.</span>
                        <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;QUERY_ROOM_RIGHTS&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ACCESS_GRANTED&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;FROM_ADMIN&quot;</span><span class="p">:</span>
                            <span class="n">demand_id</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating the room rights for self.user_rooms_rights where id = </span><span class="si">{</span><span class="n">demand_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                            <span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">demand_id</span><span class="p">:</span>
                                    <span class="n">right</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;YES&quot;</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User room rights updated&quot;</span><span class="p">)</span>

                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">)</span>
                            
                            <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;NEW_ACCESS_TO_ROOM&quot;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server ends]&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">room</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access to the room </span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s2"> has been granted ! Updating the ui now&quot;</span><span class="p">)</span>
                        
                            <span class="c1">#First we update the value in self.user_rooms_rights</span>

                            <span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="n">room</span><span class="p">:</span>
                                    <span class="n">right</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;YES&quot;</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User room rights updated&quot;</span><span class="p">)</span>

                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;destroy the complete class for Managerooms&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">)</span>
                            <span class="c1">#Now we finally restart the main ui</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;NEW_ACCESS_TO_ROOM&quot;</span><span class="p">)</span><span class="c1">#This signal not only displays the success message but also regenerates the main ui</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server ends]&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PENDING&quot;</span><span class="p">:</span>
                        <span class="n">room</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access to the room </span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s2"> is now pending validation from an admin.&quot;</span><span class="p">)</span>

                        <span class="c1">#Now we update the value in self.user_rooms_rights</span>
                        <span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="n">room</span><span class="p">:</span>
                                <span class="n">right</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PENDING&quot;</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User room rights updated&quot;</span><span class="p">)</span>
                        
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;regenerate the complete class for Managerooms&quot;</span><span class="p">)</span>
                        <span class="c1">#first we destroy the manage rooms window object</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">)</span>

                        <span class="c1">#then we tell the main ui to restart with manage rooms opened</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;ACCESS_TO_ROOM_PENDING&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server ends]&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ACCESS_DENIED&quot;</span><span class="p">:</span>
                        <span class="n">demand_id</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating the room rights for self.user_rooms_rights where id = </span><span class="si">{</span><span class="n">demand_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">demand_id</span><span class="p">:</span>
                                    <span class="n">right</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NO&quot;</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User room rights updated&quot;</span><span class="p">)</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;PENDING_RESPONSE_RECEIVED&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server ends]&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;READY_FOR_PENDING_REQUESTS&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;OK_FOR_RECEIVING&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

                    <span class="n">demands</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">single_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received a demand from server : </span><span class="si">{</span><span class="n">single_demand</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="n">demand_processed</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;demand_id&quot;</span><span class="p">:</span> <span class="n">single_demand</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s2">&quot;room_name&quot;</span><span class="p">:</span> <span class="n">single_demand</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="n">single_demand</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                            <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">single_demand</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span>
                            <span class="s2">&quot;room_id&quot;</span><span class="p">:</span> <span class="n">single_demand</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span>
                        <span class="p">}</span>

                        <span class="n">demands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">demand_processed</span><span class="p">)</span>

                        <span class="c1">#time.sleep(0.02) No need for the sleep here since we&#39;re not doing anything with pyqt (thread handling issues)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;OK_FOR_THE_REST&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                    
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;all demands are ready for display : </span><span class="si">{</span><span class="n">demands</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">demands</span> <span class="o">=</span> <span class="n">demands</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;open_admin_demand_window&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server ends]&quot;</span><span class="p">)</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CHANGING_ROOM_RIGHTS&quot;</span><span class="p">:</span><span class="c1">#for admin only to use</span>
                    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">demand</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demands</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">demand</span><span class="p">[</span><span class="s1">&#39;demand_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">demands</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
                                <span class="k">break</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;reload_admin_demand_window&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server ends]&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERRROR DURING HANDLE OF USER ROOM DEMAND ON THE SERVER SIDE&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server ends]&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;YOU_ARE_NOW_BANNED&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;closing this user&#39;s app&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;BANNED&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;closing app&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;terminate client&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Should now be disconnected, check &quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SERVER_IS_TURNING_OFF&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Closing the user&#39;s app&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;SERVER_OFF&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;closing app&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;terminate client&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Should now be disconnected, check &quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;YOU_ARE_NOW_KICKED&quot;</span><span class="p">:</span>
                    <span class="n">duration</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;closing this user&#39;s app&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KICKED|</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;closing app&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">close_application</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;terminate client&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">terminate_client</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Should now be disconnected, check &quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NEW_PRIVATE_MESSAGE&quot;</span><span class="p">:</span>
                    <span class="n">message_from</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">message_from_username</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">message_content</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>

                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current room : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_room</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_room</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">message_from</span><span class="p">):</span><span class="c1">#if we are in the discussion with the user we received a mess from</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding the message to the current discussion&quot;</span><span class="p">)</span>
                            <span class="n">formatted_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">message_from_username</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">formatted_time</span><span class="si">}</span><span class="s2">] -&gt; </span><span class="si">{</span><span class="n">message_content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">scroll_bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span>
                            <span class="n">scroll_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">scroll_bar</span><span class="o">.</span><span class="n">maximum</span><span class="p">())</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New private message received but not talking with the user currently. </span><span class="se">\n</span><span class="s2">Discarding&quot;</span><span class="p">)</span>
                            <span class="k">pass</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="c1">#this exception is here in case the current room is not private.</span>
                        <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;FRIEND_REQUEST&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;FRIEND_REQUEST_SUCCESS&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SUCCESS_ADMIN&quot;</span><span class="p">:</span>
                        <span class="n">new_friend_id</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">new_friend_name</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">new_friend_id</span><span class="p">,</span> <span class="n">new_friend_name</span><span class="p">,</span> <span class="s2">&quot;OK&quot;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;FRIEND_REQUEST_SUCCESS_ADMIN&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;USER_DOES_NOT_EXISTS&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;friend request to unknown user&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;USERS_ARE_ALREADY_FRIENDS&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;users already friends&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;USER_ALREADY_SENT_REQUEST&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;user already sent request&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;USER_WANTS_TO_BE_FRIEND_ALREADY&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;user can just accept pending demand&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;server processing it&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;UPDATE_FRIEND&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;UPATE_OK_USERS_ARENT_FRIENDS&quot;</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;friend request has been succesfully processed, we can take it off the manage friends window&quot;</span><span class="p">)</span>
                        <span class="n">demand_from</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

                        <span class="k">for</span> <span class="n">friend</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span><span class="p">:</span><span class="c1">#take the request off the user friends known</span>
                            <span class="k">if</span> <span class="n">friend</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">demand_from</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">friend</span><span class="p">)</span>
                                <span class="k">break</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;reload manage friends window&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;UPATE_OK_USERS_ARE_FRIENDS&quot;</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;friend request has been succesfully processed, we can take it off the manage friends window AND add new friend / reload main window&quot;</span><span class="p">)</span>
                        <span class="n">demand_from</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                
                        <span class="k">for</span> <span class="n">friend</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">friend</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">demand_from</span><span class="p">:</span>
                                <span class="n">friend</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OK&quot;</span>
                                <span class="k">break</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;NEW_FRIEND&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NEW_FRIEND_AVAILABLE&quot;</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A user has accepted one of our friend request, updating UI&quot;</span><span class="p">)</span>
                        <span class="n">friend_to_update</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

                        <span class="k">for</span> <span class="n">friend</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">friend</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">friend_to_update</span><span class="p">):</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating user </span><span class="si">{</span><span class="n">friend</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> to OK status as friend !&quot;</span><span class="p">)</span>
                                <span class="n">friend</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OK&quot;</span>
                                <span class="k">break</span>
        
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;reload ui new friend&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logged_in</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle listen_server ends]&quot;</span><span class="p">)</span>
                <span class="k">break</span></div>


<div class="viewcode-block" id="Client_handle.clear_central_widget">
<a class="viewcode-back" href="../client.html#client.Client_handle.clear_central_widget">[docs]</a>
    <span class="k">def</span> <span class="nf">clear_central_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode nettoie la page principale de l&#39;UI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Clear the central widget to prepare for a new UI</span>
        <span class="n">central_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">central_widget</span><span class="p">:</span>
            <span class="n">central_widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span></div>


<div class="viewcode-block" id="Client_handle.switch_to_register_ui">
<a class="viewcode-back" href="../client.html#client.Client_handle.switch_to_register_ui">[docs]</a>
    <span class="k">def</span> <span class="nf">switch_to_register_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode permet de passer de l&#39;écran de connexion à l&#39;écran d&#39;inscription durant le processus d&#39;authentification.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;REGISTER&quot;</span><span class="p">)</span>  <span class="c1"># Change the window name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_central_widget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_register_ui</span><span class="p">()</span></div>


<div class="viewcode-block" id="Client_handle.switch_to_login_ui">
<a class="viewcode-back" href="../client.html#client.Client_handle.switch_to_login_ui">[docs]</a>
    <span class="k">def</span> <span class="nf">switch_to_login_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode permet de passer de l&#39;écran d&#39;inscription à l&#39;écran de connexion durant le processus d&#39;authentification.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;LOGIN&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_central_widget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_login_ui</span><span class="p">()</span></div>


<div class="viewcode-block" id="Client_handle.create_login_ui">
<a class="viewcode-back" href="../client.html#client.Client_handle.create_login_ui">[docs]</a>
    <span class="k">def</span> <span class="nf">create_login_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode utilise les widgets offert par PyQt6 pour générer la fenêtre de connexion.</span>
<span class="sd">        La fenêtre de connexion est associée à l&#39;objet application global &#39;self.centralWidget&#39;.</span>

<span class="sd">        .. admonition:: Widgets principaux</span>

<span class="sd">            - [username_label] -&gt; Label associé à l&#39;input &quot;nom d&#39;utilisateur&quot;.</span>
<span class="sd">            - [username_input] -&gt; Zone de texte pour entrer le nom d&#39;utilisateur.</span>
<span class="sd">            - [password_label] -&gt; Label associé à l&#39;input &quot;Mot de passe&quot;</span>
<span class="sd">            - [password_input] -&gt; Zone de texte pour entrer le mot de passe (texte masqué)</span>
<span class="sd">            - [login_button] -&gt; Bouton permettant de soumettre les informations de login</span>
<span class="sd">            - [register_button] -&gt; Bouton permettant de passer à l&#39;écran d&#39;inscription</span>
<span class="sd">            - [opt_label] -&gt; Label permettant l&#39;affichage d&#39;un retour du serveur (ex: Mauvais mot de passe).</span>

<span class="sd">        :return: Rien</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">username_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Username : &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">password_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Password : &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password_input</span><span class="o">.</span><span class="n">setEchoMode</span><span class="p">(</span><span class="n">QLineEdit</span><span class="o">.</span><span class="n">EchoMode</span><span class="o">.</span><span class="n">Password</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">login_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Login&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Don&#39;t have an account ?&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Register&quot;</span><span class="p">)</span>

        <span class="n">widget_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">username_label</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">username_input</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">password_label</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">password_input</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login_button</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt_label</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_button</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widget_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>


        <span class="c1">#the element below is used tto display error messages to the user :</span>
        <span class="c1">#therefor, it is not added in the widgets&#39;s list straight away</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">login_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">On_log_user_click</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_to_register_ui</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">setVerticalSpacing</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="Client_handle.create_register_ui">
<a class="viewcode-back" href="../client.html#client.Client_handle.create_register_ui">[docs]</a>
    <span class="k">def</span> <span class="nf">create_register_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode utilise les widgets offert par PyQt6 pour générer la fenêtre d&#39;inscription.</span>
<span class="sd">        La fenêtre d&#39;inscription est associée à l&#39;object application global &#39;self.centralWidget&#39;.</span>

<span class="sd">        .. admonition:: Widgets principaux</span>

<span class="sd">            - [username_label] -&gt; Label associé à l&#39;input &quot;nom d&#39;utilisateur&quot;.</span>
<span class="sd">            - [username_input] -&gt; Zone de texte pour entrer le nom d&#39;utilisateur.</span>
<span class="sd">            - [firstname_label] -&gt; Label associé à l&#39;input &quot;Prénom&quot;.</span>
<span class="sd">            - [firstname_input] -&gt; Zone de texte pour entrer le prénom de l&#39;utilisateur.</span>
<span class="sd">            - [lastname_label] -&gt; Label associé à l&#39;input &quot;Nom&quot;.</span>
<span class="sd">            - [lastname_input] -&gt; Zone de texte pour entrer le Nom de l&#39;utilisateur.</span>
<span class="sd">            - [mail_label] -&gt; Label associé à l&#39;input &quot;Adresse mail&quot;.</span>
<span class="sd">            - [mail_input] -&gt; Zone de texte pour entrer l&#39;adresse mail de l&#39;utilisateur.</span>
<span class="sd">            - [password_label] -&gt; Label associé à l&#39;input &quot;Mot de passe&quot;</span>
<span class="sd">            - [password_input] -&gt; Zone de texte pour entrer le mot de passe (texte masqué)</span>
<span class="sd">            - [confirmpassword_label] -&gt; Label associé à l&#39;input &quot;Confirmation MdP&quot;.</span>
<span class="sd">            - [confirmpassword_input] -&gt; Zone de texte pour confirmer le Mdp de l&#39;utilisateur.</span>
<span class="sd">            - [login_button] -&gt; Bouton permettant de soumettre les informations de login</span>
<span class="sd">            - [register_button] -&gt; Bouton permettant de passer à l&#39;écran d&#39;inscription</span>
<span class="sd">            - [opt_label] -&gt; Label permettant l&#39;affichage d&#39;un retour du serveur (ex: Mauvais mot de passe).</span>

<span class="sd">        :return: Rien</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">username_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Username : &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">firstname_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;First name : &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firstname_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lastname_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Last name : &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastname_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mail_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;E-mail : &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mail_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">password_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Password : &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password_input</span><span class="o">.</span><span class="n">setEchoMode</span><span class="p">(</span><span class="n">QLineEdit</span><span class="o">.</span><span class="n">EchoMode</span><span class="o">.</span><span class="n">Password</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">confirmpassword_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Confirm password : &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confirmpassword_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confirmpassword_input</span><span class="o">.</span><span class="n">setEchoMode</span><span class="p">(</span><span class="n">QLineEdit</span><span class="o">.</span><span class="n">EchoMode</span><span class="o">.</span><span class="n">Password</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Register&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">opt_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Already have an account ?&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">login_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Login&quot;</span><span class="p">)</span>


        <span class="n">widget_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">username_label</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">username_input</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">firstname_label</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">firstname_input</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastname_label</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastname_input</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mail_label</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mail_input</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">password_label</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">password_input</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">confirmpassword_label</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">confirmpassword_input</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_button</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt_label</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login_button</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widget_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">register_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">On_reg_user_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">login_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_login_ui</span><span class="p">())</span>
        


        <span class="bp">self</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="c1">#exemple on how to set a window&#39;s width and height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">533</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.summon_error_popup">
<a class="viewcode-back" href="../client.html#client.Client_handle.summon_error_popup">[docs]</a>
    <span class="k">def</span> <span class="nf">summon_error_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_title</span><span class="p">,</span> <span class="n">Error_message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode permet d&#39;afficher à l&#39;utilisateur une petite fenêtre contenant un message d&#39;erreur ou un retour suite à une action de l&#39;application.</span>

<span class="sd">        :param window_title: Titre de la fenêtre popup</span>
<span class="sd">        :type window_title: str</span>

<span class="sd">        :param Error_message: Message à afficher au sein de la fenêtre.</span>
<span class="sd">        :type Error_message: str</span>

<span class="sd">        :ivar error: Objet PyQt6 générant un popup de message.</span>
<span class="sd">        :vartype error: object</span>

<span class="sd">        .. warning::</span>

<span class="sd">            Attention, cette méthode n&#39;est utilisable que depuis le thread principal de l&#39;application (envoie de signal par exemple).</span>
<span class="sd">            En effet, l&#39;utiliser depuis un thread secondaire ne pourra pas fonctionner car contraire au fonctionnement de la librairie PyQt6.</span>

<span class="sd">        :return: Rien</span>
<span class="sd">        :rtype: None </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">window_title</span><span class="p">)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">Error_message</span><span class="p">)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span></div>


<div class="viewcode-block" id="Client_handle.check_room_right">
<a class="viewcode-back" href="../client.html#client.Client_handle.check_room_right">[docs]</a>
    <span class="k">def</span> <span class="nf">check_room_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette methode permet de vérifier si l&#39;utilisateur à accès à un certain salon.</span>

<span class="sd">        :param room_name: Nom du salon</span>
<span class="sd">        :type room_name: str</span>

<span class="sd">        :return: Droit asocié à ce salon pour l&#39;utilisateur</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">room</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">room</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">room_name</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">room</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">right</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">right</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s2">&quot;YES&quot;</span>
                        <span class="k">elif</span> <span class="n">right</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NO&quot;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s2">&quot;NO&quot;</span>
                        <span class="k">elif</span> <span class="n">right</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;YES_IF_ASK&quot;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s2">&quot;YES_IF_ASK&quot;</span>
                        <span class="k">elif</span> <span class="n">right</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PENDING&quot;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s2">&quot;PENDING&quot;</span></div>


<div class="viewcode-block" id="Client_handle.on_user_clicked">
<a class="viewcode-back" href="../client.html#client.Client_handle.on_user_clicked">[docs]</a>
    <span class="k">def</span> <span class="nf">on_user_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">friend_id</span><span class="p">,</span> <span class="n">friend_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Méthode pour rejoindre une conversation privée avec un ami de l&#39;utilisateur.</span>

<span class="sd">        :param friend_id: UID de l&#39;ami que l&#39;on rejoint</span>
<span class="sd">        :type friend_id: int</span>

<span class="sd">        :param friend_name: Nom de l&#39;ami que l&#39;on rejoint</span>
<span class="sd">        :type friend_name: str</span>

<span class="sd">        :ivar Messages_display: Conteneur des messages de la conversation</span>
<span class="sd">        :vartype Messages_display: Pyqt object</span>

<span class="sd">        :ivar Message_input: Input de texte pour écrire un message</span>
<span class="sd">        :vartype Message_input: Pyqt object</span>

<span class="sd">        .. note:: </span>

<span class="sd">            Cette méthode se charge d&#39;associer la fonction pour envoyer un message dans la conversation lorsque l&#39;utilisateur clique sur &#39;Send&#39;.</span>
<span class="sd">            Egalement, si l&#39;utilisateur était avant dans un salon, on retire l&#39;association au bouton d&#39;envoi de la fonction permettant l&#39;envoi de message dans un salon.</span>

<span class="sd">        :return: Rien</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle on_user_clicked starts]&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start conversation with user : </span><span class="si">{</span><span class="n">friend_name</span><span class="si">}</span><span class="s2"> (uid -&gt; </span><span class="si">{</span><span class="n">friend_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_room</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PRIVATE_CONV&quot;</span><span class="p">,</span> <span class="n">friend_id</span><span class="p">,</span> <span class="n">friend_name</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Main_title</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conversation with </span><span class="si">{</span><span class="n">friend_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">send_message_server</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/need_messages_from_users </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">friend_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">listener_for_message_input</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span><span class="c1">#listener for room messages</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;an input listener was setup for room messages, taking it off.&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Send_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send_input_message</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listener_for_message_input</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_listener_for_message_input</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SETTING UP THE MESSAGE INPUT FUNCTION&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Send_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send_input_private_message</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">private_listener_for_message_input</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;send_input_private_message connect function is already set up, no need to add it again&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle on_user_clicked ends]&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.send_input_private_message">
<a class="viewcode-back" href="../client.html#client.Client_handle.send_input_private_message">[docs]</a>
    <span class="k">def</span> <span class="nf">send_input_private_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Envoie d&#39;un message sur une conversation privée.</span>

<span class="sd">        .. admonition:: Conditions</span>

<span class="sd">            - Si le message ne contient pas de caractères interdits (§, \|) -&gt; OK</span>
<span class="sd">            - Si le message ne dépasse pas les 1000 caractères -&gt; OK</span>
<span class="sd">            - Sinon, on renvoie à l&#39;utilisateur un message d&#39;erreur.</span>

<span class="sd">        :return: Rien</span>
<span class="sd">        :rtype: None</span>

<span class="sd">        :ivar formatted_time: Date &amp; Heure d&#39;envoi du message</span>
<span class="sd">        :vartype formatted_time: datetime</span>

<span class="sd">        :ivar Message: Message envoyé au serveur sous la forme : &quot;/private_message UID|ID_conversation|contenu du message&quot;.</span>
<span class="sd">        :vartype Message: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">has_forbidden_characters</span><span class="p">(</span><span class="n">input_string</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Verifie si un string contient certains caracteres.</span>

<span class="sd">            :param input_string: Valeur à analyser</span>
<span class="sd">            :type input_string: str</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">char</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;§&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">}</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">input_string</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">has_forbidden_characters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">text</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;THIS MESSAGE CONTAINS BANNED CARACTERS, ABORTING&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;CANNOT SEND SPECIAL CARACTERS&quot;</span><span class="p">,</span> <span class="s2">&quot;The message you are trying to send contains banned caracters (§ or |), please remove them before sending the message !</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;THIS MESSAGE HAS TOO MANY CARACTERS&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;MESSAGE TOO LONG&quot;</span><span class="p">,</span> <span class="s2">&quot;The message you are trying to send is longer than 1000 caracters, please make the message shorter before sending it !</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">Message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/private_message </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_room</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message sent to the server : </span><span class="si">{</span><span class="n">Message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
        <span class="c1">#Updating the conversation with the message:</span>
        <span class="n">formatted_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;Username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">formatted_time</span><span class="si">}</span><span class="s2">] -&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">send_message_server</span><span class="p">(</span><span class="n">Message</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.send_input_message">
<a class="viewcode-back" href="../client.html#client.Client_handle.send_input_message">[docs]</a>
    <span class="k">def</span> <span class="nf">send_input_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Envoie d&#39;un message sur un salon.</span>

<span class="sd">        .. admonition:: Conditions</span>

<span class="sd">            - Si le message ne contient pas de caractères interdits (§, \|) -&gt; OK</span>
<span class="sd">            - Si le message ne dépasse pas les 1000 caractères -&gt; OK</span>
<span class="sd">            - Sinon, on renvoie à l&#39;utilisateur un message d&#39;erreur.</span>

<span class="sd">        :return: Rien</span>
<span class="sd">        :rtype: None</span>

<span class="sd">        :ivar formatted_time: Date &amp; Heure d&#39;envoi du message</span>
<span class="sd">        :vartype formatted_time: datetime</span>

<span class="sd">        :ivar Message: Message envoyé au serveur sous la forme : &quot;/room_message ID_Salon|UID|contenu du message&quot;.</span>
<span class="sd">        :vartype Message: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">has_forbidden_characters</span><span class="p">(</span><span class="n">input_string</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Verifie si un string contient certains caracteres.</span>

<span class="sd">            :param input_string: Valeur à analyser</span>
<span class="sd">            :type input_string: str</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">char</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;§&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">}</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">input_string</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">has_forbidden_characters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">text</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;THIS MESSAGE CONTAINS BANNED CARACTERS, ABORTING&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;CANNOT SEND SPECIAL CARACTERS&quot;</span><span class="p">,</span> <span class="s2">&quot;The message you are trying to send contains banned caracters (§ or |), please remove them before sending the message !</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;THIS MESSAGE HAS TOO MANY CARACTERS&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;MESSAGE TOO LONG&quot;</span><span class="p">,</span> <span class="s2">&quot;The message you are trying to send is longer than 1000 caracters, please make the message shorter before sending it !</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">Message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/room_message </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_room</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message sent to the server : </span><span class="si">{</span><span class="n">Message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1">#Updating the conversation with the message we sent:</span>
        <span class="n">formatted_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;Username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">formatted_time</span><span class="si">}</span><span class="s2">] -&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">send_message_server</span><span class="p">(</span><span class="n">Message</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.create_main_ui">
<a class="viewcode-back" href="../client.html#client.Client_handle.create_main_ui">[docs]</a>
    <span class="k">def</span> <span class="nf">create_main_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode utilise les Widgets offert par PyQt6 pour générer la page principale de l&#39;application.</span>
<span class="sd">        Cette page principale est associée à l&#39;objet application global &#39;self.centralWidget&#39;.</span>

<span class="sd">        :ivar user_buttons: Ce tableau permet de stocker chaque association ami/bouton pour y connecter la fonction associée par la suite.</span>
<span class="sd">        :vartype user_buttons: array</span>

<span class="sd">        .. admonition:: Elements principaux</span>

<span class="sd">            - [Friends_column] -&gt; Première colonne en partant de la gauche sur l&#39;UI.</span>
<span class="sd">            - [Rooms_column] -&gt; Seconde colonne en partant de la gauche sur l&#39;UI. </span>
<span class="sd">            - [scroll_area] -&gt; Widget au sein de &#39;Friends_column&#39; pour permettre de scroller au sein de la colonne si les amis affichés dépassent la hauteur max de la colonne.</span>
<span class="sd">            - [Friend Buttons] -&gt; Chaque ami de l&#39;utilisateur est représenté par un bouton. Lorsque celui-ci est pressé, la conversation avec cette personne est chargée.</span>
<span class="sd">            - [manage_friends] -&gt; Bouton permettant à l&#39;utilisateur d&#39;ouvrir la fenêtre de gestion des amis.</span>
<span class="sd">            - [Pour chaque salon connu de l&#39;utilisateur] -&gt; Création d&#39;un bouton associé pour rejoindre le-dit salon.</span>
<span class="sd">            - [manage_rooms] -&gt; Bouton permettant à l&#39;utilisateur d&#39;ouvrir la fenêtre de gestion des salons.</span>
<span class="sd">            - [main_container] -&gt; Conteneur de la partie principale (à droite) de l&#39;UI.</span>
<span class="sd">            - [Message_input] -&gt; Input texte où l&#39;utilisateur écrit ses messages.</span>
<span class="sd">            - [Send_button] -&gt;  Bouton d&#39;envoi du message.</span>
<span class="sd">            - [Messages_display] -&gt; Section ou sont affichés les messages de salons / privés</span>
<span class="sd">            - [Main_title] -&gt; Titre en haut de page (utile pour afficher la conversation en cour)  </span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>

<span class="sd">            Si l&#39;utilisateur est un admin, alors celui ci aura une fenêtre de gestion des salons différente.</span>
<span class="sd">            En effet, au lieu d&#39;afficher la possibilité de demander l&#39;accès à un salon X, l&#39;utilisateur aura accès à la liste des demandes d&#39;autres utilisateurs pour rejoindre X ou Y salons.</span>
<span class="sd">            Il a alors la possibilité d&#39;accepter ou refuser chaque demande.</span>

<span class="sd">        :return: Rien</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;CHandler&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;CHandler&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">1102</span><span class="p">,</span> <span class="mi">553</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">1102</span><span class="p">,</span> <span class="mi">553</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumSize</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">1102</span><span class="p">,</span> <span class="mi">553</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;centralwidget&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">Friends_column</span> <span class="o">=</span> <span class="n">QColumnView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Friends_column</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">511</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Friends_column</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #656565;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Friends_column</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;Friends_column&quot;</span><span class="p">)</span>

        <span class="c1">#Displaying friends to the friends column : </span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Friends_column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">430</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;border: none;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;SCROLL_AREA_FRIENDS&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_widget</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">user_buttons</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">color_palette</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;#faf0db&quot;</span><span class="p">,</span> <span class="s2">&quot;#dfd7bb&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;#fbebc7&quot;</span><span class="p">,</span> <span class="s2">&quot;#d0c3a7&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;#fbdfb3&quot;</span><span class="p">,</span> <span class="s2">&quot;#ceb793&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;#f7b886&quot;</span><span class="p">,</span> <span class="s2">&quot;#c6956e&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;#f5b678&quot;</span><span class="p">,</span> <span class="s2">&quot;#cf9964&quot;</span><span class="p">]]</span><span class="c1">#each one [BG color/Border color]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
            
        <span class="k">for</span> <span class="n">friend</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">friend</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span><span class="c1">#if friend status is &quot;OK&quot;</span>
                <span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">friend</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">button</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
                <span class="n">button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;background-color: </span><span class="si">{</span><span class="n">color_palette</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span><span class="se">\n</span><span class="s2">&quot;&quot;color: black;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="sa">f</span><span class="s2">&quot;border: 2px solid </span><span class="si">{</span><span class="n">color_palette</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">user_buttons</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">button</span><span class="p">,</span> <span class="n">friend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">friend</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scroll_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">scroll_layout</span><span class="o">.</span><span class="n">addSpacing</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
        
                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>


        <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_buttons</span><span class="p">:</span>
            <span class="n">button</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_user_clicked</span><span class="p">,</span> <span class="n">button</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">button</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">manage_friends</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_friends</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">41</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_friends</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;manage_friends&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Rooms_column</span> <span class="o">=</span> <span class="n">QColumnView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rooms_column</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">511</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rooms_column</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #737373;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rooms_column</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;Rooms_column&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Rooms_column</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

        <span class="c1">#========================CREATE ALL THE ROOMS =================================</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;About to create all rooms.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rooms available to the user : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rooms rights of the user : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1">#change the labels into buttons for interactions !</span>
        <span class="c1">#look at marketing for a template</span>

        <span class="c1">#CREATING GENERAL ROOM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">general_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">general_widget</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">general_widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;general_widget&quot;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">general_widget_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">general_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">general_widget_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">general_widget_button</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;general_widget_button&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">general_widget_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Général&quot;</span><span class="p">)</span>

        <span class="n">room_rights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_room_right</span><span class="p">(</span><span class="s2">&quot;Général&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">general_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #00C113;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #019210&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;NO&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">general_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #FF0000;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;YES_IF_ASK&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">general_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #D18438;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #af6e2e&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;PENDING&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">general_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #247BC2;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #1d5f94&quot;</span><span class="p">)</span>
                            

        <span class="bp">self</span><span class="o">.</span><span class="n">general_widget</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">general_widget_button</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">general_widget_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_room_widget_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="c1">#CREATING BLABLA ROOM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;blabla_widget&quot;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget_button</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;blabla_widget_button&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Blabla&quot;</span><span class="p">)</span>

        <span class="n">room_rights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_room_right</span><span class="p">(</span><span class="s2">&quot;Blabla&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #00C113;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #019210&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;NO&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #FF0000;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;YES_IF_ASK&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #D18438;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #af6e2e&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;PENDING&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #247BC2;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #1d5f94&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget_button</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">blabla_widget_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_room_widget_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>


        <span class="c1">#CREATING COMPTA ROOM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;compta_widget&quot;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compta_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget_button</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;compta_widget_button&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Comptabilité&quot;</span><span class="p">)</span>

        <span class="n">room_rights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_room_right</span><span class="p">(</span><span class="s2">&quot;Comptabilité&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #00C113;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #019210&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;NO&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #FF0000;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;YES_IF_ASK&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #D18438;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #af6e2e&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;PENDING&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #247BC2;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #1d5f94&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget_button</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compta_widget_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_room_widget_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>


        <span class="c1">#CREATING INFO ROOM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_widget</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;info_widget&quot;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">info_widget_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_widget_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_widget_button</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;info_widget_button&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_widget_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Informatique&quot;</span><span class="p">)</span>

        <span class="n">room_rights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_room_right</span><span class="p">(</span><span class="s2">&quot;Informatique&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #00C113;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #019210&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;NO&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #FF0000;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;YES_IF_ASK&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #D18438;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #af6e2e&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;PENDING&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #247BC2;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #1d5f94&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">info_widget</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_widget_button</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info_widget_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_room_widget_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>


        <span class="c1">#CREATING MARKETING ROOM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">294</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;marketing_widget&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget_button</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;marketing_widget_button&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Marketing&quot;</span><span class="p">)</span>

        <span class="n">room_rights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_room_right</span><span class="p">(</span><span class="s2">&quot;Marketing&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #00C113;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #019210&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;NO&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #FF0000;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;YES_IF_ASK&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #D18438;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #af6e2e&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">room_rights</span> <span class="o">==</span> <span class="s2">&quot;PENDING&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #247BC2;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid #1d5f94&quot;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget_button</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">marketing_widget_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_room_widget_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        
        
        <span class="c1">#========================DONE CREATING ALL THE ROOMS =================================</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">manage_rooms</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_rooms</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">41</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_rooms</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;manage_rooms&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_container</span> <span class="o">=</span> <span class="n">QColumnView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_container</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">440</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">651</span><span class="p">,</span> <span class="mi">511</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_container</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;main_container&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">455</span><span class="p">,</span> <span class="mi">455</span><span class="p">,</span> <span class="mi">531</span><span class="p">,</span> <span class="mi">41</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: white;</span><span class="se">\n</span><span class="s2">&quot;&quot;border: 2px solid black; color: black;</span><span class="se">\n</span><span class="s2">&quot;&quot;border-radius: 5px;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;Message_input&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Send_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Send_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">1010</span><span class="p">,</span> <span class="mi">457</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">35</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Send_button</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;Send_button&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">columnView_4</span> <span class="o">=</span> <span class="n">QColumnView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columnView_4</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">440</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">651</span><span class="p">,</span> <span class="mi">81</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columnView_4</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #d4cbb6;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columnView_4</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;columnView_4&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span> <span class="o">=</span> <span class="n">QTextEdit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">455</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">621</span><span class="p">,</span> <span class="mi">341</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: white;</span><span class="se">\n</span><span class="s2">&quot;&quot;border-radius: 5px;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;Messages_display&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Main_title</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Main_title</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">511</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Main_title</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Main_title</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Main_title</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;Main_title&quot;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">Friends_column</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_friends</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_rooms</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_container</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Send_button</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columnView_4</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Main_title</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">statusbar</span> <span class="o">=</span> <span class="n">QStatusBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusbar</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;statusbar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setStatusBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statusbar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span> <span class="o">=</span> <span class="n">QMenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1102</span><span class="p">,</span> <span class="mi">22</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;menuBar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMenuBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">)</span>


        <span class="n">_translate</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_friends</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;MainWindow&quot;</span><span class="p">,</span> <span class="s2">&quot;Manage friends&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;User_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ADMIN&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manage_rooms</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;MainWindow&quot;</span><span class="p">,</span> <span class="s2">&quot;Manage demands&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manage_rooms</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;MainWindow&quot;</span><span class="p">,</span> <span class="s2">&quot;Manage rooms&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Send_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;MainWindow&quot;</span><span class="p">,</span> <span class="s2">&quot;Send&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Main_title</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;MainWindow&quot;</span><span class="p">,</span> <span class="s2">&quot;Welcome to CHandler !&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Main_title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: black;</span><span class="se">\n</span><span class="s2">&quot;&quot;font-size: 30px;</span><span class="se">\n</span><span class="s2">&quot;&quot;font-weight: bold;&quot;</span><span class="p">)</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QMetaObject</span><span class="o">.</span><span class="n">connectSlotsByName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;User_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ADMIN&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manage_rooms</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manage_demands_action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manage_rooms</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manage_rooms_action</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_friends</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manage_friends_action</span><span class="p">)</span>

        <span class="k">pass</span></div>


<div class="viewcode-block" id="Client_handle.on_room_widget_clicked">
<a class="viewcode-back" href="../client.html#client.Client_handle.on_room_widget_clicked">[docs]</a>
    <span class="k">def</span> <span class="nf">on_room_widget_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room_object</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode gère l&#39;évènement lorsque l&#39;utilisateur clique sur un salon.</span>

<span class="sd">        :param room_object: Objet &#39;salon&#39; contenant les informations suivantes : [id salon, nom salon]</span>
<span class="sd">        :type room_object: object</span>

<span class="sd">        :ivar Messages_display: Affichage des messages sur l&#39;UI</span>
<span class="sd">        :vartype Messages_display: object</span>

<span class="sd">        :ivar Message_input: Input textuel ou l&#39;utilisateur entre le message à envoyer.</span>
<span class="sd">        :vartype Message_input: object</span>

<span class="sd">        .. admonition:: Conditions</span>

<span class="sd">            - Si l&#39;utilisateur à les droits d&#39;accès au salon -&gt; OK</span>
<span class="sd">            - Si l&#39;utilisateur n&#39;a pas les droits d&#39;accès au salon -&gt; on renvoie une erreur à l&#39;utilisateur.</span>
<span class="sd">            - Sinon -&gt; On renvoie à l&#39;utilisateur la procédure à suivre pour potentiellement accéder au salon.</span>

<span class="sd">        :return: Rien</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle on_room_widget_clicked starts]&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;room </span><span class="si">{</span><span class="n">room_object</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> clicked !&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">check_rights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_room_right</span><span class="p">(</span><span class="n">room_object</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">check_rights</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User has rights for this server.&quot;</span><span class="p">)</span>

            <span class="c1">#Now we update the current room to the user&#39;s rights</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_room</span> <span class="o">=</span> <span class="n">room_object</span>
            <span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">room_object</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_room_rights</span> <span class="o">=</span> <span class="n">right</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_room</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_room_rights</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Message_input</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Main_title</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Salon </span><span class="si">{</span><span class="n">room_object</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1">#HERE WE GATHER ALL THE PREVIOUS MESSAGES FROM THIS ROOM : </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_message_server</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/need_messages_from_room </span><span class="si">{</span><span class="n">room_object</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_listener_for_message_input</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Send_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send_input_private_message</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">private_listener_for_message_input</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span> 
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">listener_for_message_input</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SETTING UP THE MESSAGE INPUT FUNCTION&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Send_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send_input_message</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listener_for_message_input</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;send_input_message connect function is already set up, no need to add it again&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle on_room_widget_clicked ends]&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">check_rights</span> <span class="o">==</span> <span class="s2">&quot;NO&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;User Rights Issue&quot;</span><span class="p">,</span> <span class="s2">&quot;You do not have the appropriate rights to join this room.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle on_general_widget_clicked ends]&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">check_rights</span> <span class="o">==</span> <span class="s2">&quot;YES_IF_ASK&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;Need to ask first&quot;</span><span class="p">,</span> <span class="s2">&quot;You do not have the appropriate rights to join this room yet.</span><span class="se">\n\n</span><span class="s2">Please click on the &#39;Manage rooms&#39; button.</span><span class="se">\n</span><span class="s2">Then, ask to join the room, it will update instantly.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle on_general_widget_clicked ends]&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">check_rights</span> <span class="o">==</span> <span class="s2">&quot;PENDING&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;Demand is still pending&quot;</span><span class="p">,</span> <span class="s2">&quot;You won&#39;t be able to join this channel until an admin has accepted your demand.</span><span class="se">\n\n</span><span class="s2">Please be patient or contact one.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle on_general_widget_clicked ends]&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.request_friend">
<a class="viewcode-back" href="../client.html#client.Client_handle.request_friend">[docs]</a>
    <span class="k">def</span> <span class="nf">request_friend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">friend_username</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode gère l&#39;envoie au serveur d&#39;une nouvelle demande d&#39;ami.</span>

<span class="sd">        :param friend_username: Nom de l&#39;utilisateur à ajouter.</span>
<span class="sd">        :type friend_username: str</span>

<span class="sd">        .. note::</span>
<span class="sd">            Si l&#39;utilisateur est un admin, la demande d&#39;ami sera immédiatement acceptée coté serveur.</span>
<span class="sd">            Dans le cas échéant, la demande sera soumise et l&#39;utilisateur invité devra alors accepter ou refuser la demande d&#39;ami.</span>

<span class="sd">        :return: Rien</span>
<span class="sd">        :rtype: None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending a friend request for </span><span class="si">{</span><span class="n">friend_username</span><span class="si">}</span><span class="s2"> !&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;User_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ADMIN&quot;</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/friend_request </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">friend_username</span><span class="si">}</span><span class="s2">|FORCE&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/friend_request </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">friend_username</span><span class="si">}</span><span class="s2">|NORMAL&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span></div>


<div class="viewcode-block" id="Client_handle.manage_friends_action">
<a class="viewcode-back" href="../client.html#client.Client_handle.manage_friends_action">[docs]</a>
    <span class="k">def</span> <span class="nf">manage_friends_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode gère l&#39;évenement lorsque l&#39;utilisateur clique sur le bouton &#39;Manage Friends&#39;.</span>

<span class="sd">        :return: Envoi d&#39;un signal pour ouvrir la fenêtre de gestion des amis.</span>
<span class="sd">        :rtype: signal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_Handler manage_friends_action start]&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current friends of the user : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User data : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;start friends window&quot;</span><span class="p">)</span>
    
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_Handler manage_friends_action ends]&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.manage_rooms_action">
<a class="viewcode-back" href="../client.html#client.Client_handle.manage_rooms_action">[docs]</a>
    <span class="k">def</span> <span class="nf">manage_rooms_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode gère l&#39;évenement lorsque l&#39;utilisateur clique sur le bouton &#39;Manage Rooms&#39;.</span>

<span class="sd">        :ivar POPUP: Création d&#39;une fenêtre popup pour l&#39;affichage de la gestion des salons.</span>
<span class="sd">        :vartype POPUP: PyQt object</span>

<span class="sd">        .. note::</span>

<span class="sd">            On associe la fenêtre de gestion des salons à la variable &#39;ui&#39; de notre fenêtre principale.</span>
<span class="sd">            Egalement, on attache un signal d&#39;opération à cette fenetre afin de pouvoir modifier l&#39;aspect de la fenêtre en fonction d&#39;une évolution.</span>

<span class="sd">        </span>
<span class="sd">        .. note::</span>

<span class="sd">            On associe également à chaque salon la methode &#39;request_access_to_room&#39; afin de permettre à l&#39;utilisateur de demander un changement de droits pour l&#39;un des salons.</span>

<span class="sd">        .. todo::</span>

<span class="sd">            Passer la boucle &#39;for&#39; en récursif afin de permettre un fonctionnement de cette méthode independamment du nombre de salons existants.</span>
<span class="sd">            Il s&#39;agit du seul endroit à modifier pour permettre la création de nouveaux salons par les utilisateurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_Handler manage_rooms_action start]&quot;</span><span class="p">)</span>

        <span class="c1">#first get current rooms rights for this user</span>

        <span class="c1">#Now we create a class representing the popup window to handle rooms</span>
        <span class="n">POPUP</span> <span class="o">=</span> <span class="n">QDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Manage_rooms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms_rights</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">perform_ui_operation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">gen_ui</span><span class="p">(</span><span class="n">POPUP</span><span class="p">)</span>
        <span class="n">POPUP</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1">#this loop matches every button to its corresponding function to execute</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="mi">1</span><span class="c1">#This can be later updated to gather the value from len(self.user_rooms) when users can create rooms</span>
        <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttons</span><span class="p">:</span>
            <span class="k">match</span> <span class="n">iteration</span><span class="p">:</span>
                <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User should always have access to general, so no asking&quot;</span><span class="p">)</span>
                <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_access_to_room</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_access_to_room</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
                <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_access_to_room</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
                <span class="k">case</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_access_to_room</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>



        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_Handler manage_rooms_action ends]&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.manage_demands_action">
<a class="viewcode-back" href="../client.html#client.Client_handle.manage_demands_action">[docs]</a>
    <span class="k">def</span> <span class="nf">manage_demands_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode permet l&#39;affichage d&#39;une fenêtre pour gérer les demandes d&#39;autres utilisateurs souhaitant rejoindre un nouveau salon.</span>

<span class="sd">        :ivar request: Requete envoyée au serveur : /request_for_admin_demands ID Utilisateur</span>
<span class="sd">        :vartype request: str</span>

<span class="sd">        .. warning::</span>

<span class="sd">            Cette méthode n&#39;est utilisable que si l&#39;utilisateur est un admin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_Handler manage_demands_action starts]&quot;</span><span class="p">)</span>
        
        <span class="n">request</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/request_for_admin_demands </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_Handler manage_demands_action ends]&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.request_access_to_room">
<a class="viewcode-back" href="../client.html#client.Client_handle.request_access_to_room">[docs]</a>
    <span class="k">def</span> <span class="nf">request_access_to_room</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode permet l&#39;envoi d&#39;une demande utilisateur pour rejoindre un nouveau salon.</span>

<span class="sd">        :param room_id: ID du salon en question.</span>
<span class="sd">        :type room_id: int</span>

<span class="sd">        :ivar room: Variable stockant les infos relatives au salon auquel l&#39;utilisateur souhaite accéder.</span>
<span class="sd">        :vartype room: array</span>

<span class="sd">        :ivar request: Requête envoyée au serveur : /query_for_room_rights Room_id|User_id</span>
<span class="sd">        :vartype request: str</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_Handler request_access_to_room starts]&quot;</span><span class="p">)</span>
        <span class="n">room</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_rooms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">room_id</span><span class="p">:</span>
                <span class="n">room</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">request</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/query_for_room_rights </span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_Handler request_access_to_room ends]&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.perform_ui_operation">
<a class="viewcode-back" href="../client.html#client.Client_handle.perform_ui_operation">[docs]</a>
    <span class="k">def</span> <span class="nf">perform_ui_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span><span class="c1">#PRIMARY THREAD (ALTER UI HERE)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ================</span>
<span class="sd">        THREAD PRINCIPAL</span>
<span class="sd">        ================</span>

<span class="sd">        Cette méthode représente le thread principale de l&#39;interface utilisateur.</span>
<span class="sd">        Tout changement dans l&#39;UI doit être effectué ici (ou à minima initié ici).</span>

<span class="sd">        Le fonctionnement de cette méthode est le suivant; pour chaque signal reçu depuis une autre partie du programme,</span>
<span class="sd">        une action y est associée.</span>

<span class="sd">        Vous pouvez retrouver ci-dessous la liste de chacune de ces actions en fonction d&#39;un signal S.</span>

<span class="sd">        :param operation: Signal reçu du programme</span>
<span class="sd">        :type operation: str</span>

<span class="sd">        .. admonition:: SIGNALS</span>

<span class="sd">            - [login success] -&gt; Le client est bien connecté, démarrage de la fenêtre principale.</span>
<span class="sd">            - [register success] -&gt; Le client est bien connecté, démarrage de la fenêtre principale.</span>
<span class="sd">            - [NEW_ACCESS_TO_ROOM] -&gt; Le client a accès à un nouveau salon, redémarrage de l&#39;UI pour la mettre à jour.</span>
<span class="sd">            - [NEW_FRIEND] -&gt; Le client à un nouvel ami, redémarrage de l&#39;UI pour la mettre à jour.</span>
<span class="sd">            - [PENDING_RESPONSE_RECEIVED] -&gt; Un admin a refusé l&#39;accès à un salon au client, redémarrage de l&#39;UI pour la mettre à jour.</span>
<span class="sd">            - [ACCESS_TO_ROOM_PENDING] -&gt; La demande d&#39;accès à un nouveau salon par le client à bien été pris en compte, redémarrage de l&#39;UI pour la mettre à jour.</span>
<span class="sd">            - [open_admin_demand_window] -&gt; Ouverture de la fenêtre de gestion de demande d&#39;accès aux salons par les utilisateurs.</span>
<span class="sd">            - [reload_admin_demand_window] -&gt; Rechargement de la fenêtre de gestion des demandes d&#39;accès.</span>
<span class="sd">            - [BANNED] -&gt; Le client à été banni, fermeture de l&#39;application.</span>
<span class="sd">            - [friend request to unknown user] -&gt; Le client à tenté d&#39;ajouter en ami un utilisateur non-existant.</span>
<span class="sd">            - [SERVER_OFF] -&gt; Le serveur à été coupé, fermeture de l&#39;application.</span>
<span class="sd">            - [users already friends] -&gt; Le client à tenté d&#39;ajouter un ami avec lequel il est déjà ami.</span>
<span class="sd">            - [user already sent request] -&gt; Le client à tenté d&#39;ajouter un ami plus d&#39;une fois.</span>
<span class="sd">            - [user can just accept pending demand] -&gt; Le client à tenté d&#39;ajouter en ami un utilisateur qui souhaite déjà être son ami</span>
<span class="sd">            - [reload manage friends window] -&gt; Rechargement de la fenêtre de gestion des amis.</span>
<span class="sd">            - [start friends window] -&gt; Démarrage de la fenêtre de gestion des amis.</span>
<span class="sd">            - [FRIEND_REQUEST_SUCCESS] -&gt; Le serveur à bien reçu la demande d&#39;ami de l&#39;utilisateur.</span>
<span class="sd">            - [FRIEND_REQUEST_SUCCESS_ADMIN] -&gt; Le serveur à bien ajouté un nouvel ami sans confirmation nécessaire (admin uniquement)</span>
<span class="sd">            - [reload ui new friend] -&gt; L&#39;utilisateur à un nouvel ami, rechargement de l&#39;UI pour la mettre à jour.</span>
<span class="sd">            - [KICKED] -&gt; L&#39;utilisateur à été kick pour une durée determinée, fermeture de l&#39;application.</span>

<span class="sd">        </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;operation : </span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;login success&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We should start the main loop here and close login UI !&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cleaning window&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_central_widget</span><span class="p">()</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;now start real ui&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_main_ui</span><span class="p">()</span>
 

            <span class="bp">self</span><span class="o">.</span><span class="n">server_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">listen_server</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LISTEN_SERVER&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">server_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;register success&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We should start the main loop here and close login UI !&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cleaning window&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_central_widget</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;now start real ui&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_main_ui</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">server_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">listen_server</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LISTEN_SERVER&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">server_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;NEW_ACCESS_TO_ROOM&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;NEW ROOM ACCESSIBLE&quot;</span><span class="p">,</span> <span class="s2">&quot;A new room is now accessible, the UI will now be restarted.</span><span class="se">\n\n</span><span class="s2">Feel free to join it and say hi !</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">clear_central_widget</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">create_main_ui</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;NEW_FRIEND&quot;</span><span class="p">:</span>        
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;NEW FRIEND&quot;</span><span class="p">,</span> <span class="s2">&quot;You now have a new friend, the UI will be restarted to take changes into account.</span><span class="se">\n\n</span><span class="s2">Feel free to message your new friend to say hi !</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">popup</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">popup</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_central_widget</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">create_main_ui</span><span class="p">()</span>
        
            <span class="k">if</span> <span class="n">popup</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;start friends window&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;PENDING_RESPONSE_RECEIVED&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;PENDING DEMAND REVIEWED&quot;</span><span class="p">,</span> <span class="s2">&quot;An admin has reviewed one of your demands to join a room and decided not to let you access it.</span><span class="se">\n\n</span><span class="s2">We can&#39;t provide much more information, feel free to check with your admin to know why.</span><span class="se">\n\n</span><span class="s2">The UI will now be restarted taking this into account.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">clear_central_widget</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">create_main_ui</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;ACCESS_TO_ROOM_PENDING&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;DEMAND SUBMITED !&quot;</span><span class="p">,</span><span class="s2">&quot;Your request has been sent to the admin.</span><span class="se">\n\n</span><span class="s2">This room will be available as soon as they decide to let you in.</span><span class="se">\n\n</span><span class="s2">We will now reload the app to update the data.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">clear_central_widget</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">create_main_ui</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">manage_rooms_action</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;open_admin_demand_window&quot;</span><span class="p">:</span>
            <span class="n">POPUP</span> <span class="o">=</span> <span class="n">QDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Manage_demands</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demands</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">perform_ui_operation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">gen_ui</span><span class="p">(</span><span class="n">POPUP</span><span class="p">)</span>
            <span class="n">POPUP</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ready to join buttons with function for data : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">demands</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">liste</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">button_lists</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Demand associated : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">demands</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Demand id : </span><span class="si">{</span><span class="n">liste</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1">#liste[0] = ACCEPT BUTTON / liste[1] = DENY BUTTON / liste[2] = demand_id</span>
                <span class="n">demand_id</span> <span class="o">=</span> <span class="n">liste</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">demand_uid</span> <span class="o">=</span> <span class="n">liste</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;liste : </span><span class="si">{</span><span class="n">liste</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">liste</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_user_demand</span><span class="p">,</span> <span class="n">demand_id</span><span class="p">,</span> <span class="n">demand_uid</span><span class="p">,</span> <span class="s2">&quot;OK&quot;</span><span class="p">))</span>
                <span class="n">liste</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_user_demand</span><span class="p">,</span> <span class="n">demand_id</span><span class="p">,</span> <span class="n">demand_uid</span><span class="p">,</span> <span class="s2">&quot;NOK&quot;</span><span class="p">))</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;reload_admin_demand_window&quot;</span><span class="p">:</span>
            <span class="c1">#reload popup window</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;ROOM ACCESS CHANGED !&quot;</span><span class="p">,</span> <span class="s2">&quot;The server confirmed the changes made for this user&#39;s access.</span><span class="se">\n\n</span><span class="s2">This window will now be reloaded with the updated data</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;And now we rebuild it with updated values&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;open_admin_demand_window&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;BANNED&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;YOU ARE BANNED&quot;</span><span class="p">,</span> <span class="s2">&quot;You have been banned by an admin. </span><span class="se">\n\n</span><span class="s2">This application will now be closed, you will never be able to login again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;friend request to unknown user&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;USER DOES NOT EXIST&quot;</span><span class="p">,</span> <span class="s2">&quot;The user you are trying to send a friend request to does not exist.</span><span class="se">\n\n</span><span class="s2">Please verify the Username you entered and/or retry.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;SERVER_OFF&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;SERVER IS TURNING OFF&quot;</span><span class="p">,</span> <span class="s2">&quot;The server is turning off, you will now be disconnected too.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;users already friends&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;USER IS A FRIEND&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The user you are trying to send a request to is already your friend.</span><span class="se">\n\n</span><span class="s2">Therefore sending a request does not make sense.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;user already sent request&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;REQUEST ALREADY SENT&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You already sent a friend request to this user.</span><span class="se">\n\n</span><span class="s2">Please simply wait for them to accept it.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;user can just accept pending demand&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;USER SENT YOU A REQUEST&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This user already sent you a friend request !</span><span class="se">\n\n</span><span class="s2">Simply look for the demand in the &#39;Manage friends&#39; section of the app.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;reload manage friends window&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;now rebuilding manage friends window..&quot;</span><span class="p">)</span>
                    
            <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;start friends window&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;start friends window&quot;</span><span class="p">:</span>
            <span class="n">friend_requests</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">friend</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_friends</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">friend</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PENDING&quot;</span><span class="p">:</span>
                    <span class="n">friend_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">friend</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="n">POPUP</span> <span class="o">=</span> <span class="n">QDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Manage_friends</span><span class="p">(</span><span class="n">friend_requests</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">perform_ui_operation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">gen_ui</span><span class="p">(</span><span class="n">POPUP</span><span class="p">)</span>
            <span class="n">POPUP</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="c1">#setup listener for the form to add a friend</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">send_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_friend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">form_input</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">liste</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">button_lists</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;friend request associated : </span><span class="si">{</span><span class="n">friend_requests</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request UID : </span><span class="si">{</span><span class="n">liste</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">request_from_uid</span> <span class="o">=</span> <span class="n">liste</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;liste : </span><span class="si">{</span><span class="n">liste</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
                <span class="n">liste</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_friend_request</span><span class="p">,</span> <span class="n">request_from_uid</span><span class="p">,</span> <span class="s2">&quot;OK&quot;</span><span class="p">))</span>
                <span class="n">liste</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_friend_request</span><span class="p">,</span> <span class="n">request_from_uid</span><span class="p">,</span> <span class="s2">&quot;NOK&quot;</span><span class="p">))</span>

                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;FRIEND_REQUEST_SUCCESS&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;FRIEND REQUEST SUBMITTED&quot;</span><span class="p">,</span> <span class="s2">&quot;The friend request has well been submitted to the user !</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;FRIEND_REQUEST_SUCCESS_ADMIN&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;FRIEND ADDED&quot;</span><span class="p">,</span> <span class="s2">&quot;Since you are an admin, the request has been submitted and validated !</span><span class="se">\n\n</span><span class="s2">You can now talk with the user.</span><span class="se">\n\n</span><span class="s2">We will now reload the main window to take changes into account.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">popup</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1">#destroying the popup</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">popup</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1">#clearing main page</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_central_widget</span><span class="p">()</span>
            <span class="c1">#reloading main page</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_main_ui</span><span class="p">()</span>
            <span class="c1">#reloading popup</span>
            <span class="k">if</span> <span class="n">popup</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui_operation_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;start friends window&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;reload ui new friend&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;YOU HAVE A NEW FRIEND&quot;</span><span class="p">,</span> <span class="s2">&quot;You have a new friend, we will now restart the UI to take the changes into account.</span><span class="se">\n\n</span><span class="s2">Feel free to say hi to them !</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_central_widget</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">create_main_ui</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">operation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;KICKED&quot;</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">operation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">duration_in_minutes</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">60</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summon_error_popup</span><span class="p">(</span><span class="s2">&quot;YOU ARE KICKED&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;You have been kicked by an admin for </span><span class="si">{</span><span class="n">duration_in_minutes</span><span class="si">}</span><span class="s2"> minutes.</span><span class="se">\n\n</span><span class="s2">For more information, please feel free to ask them.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Other message idk&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.handle_user_demand">
<a class="viewcode-back" href="../client.html#client.Client_handle.handle_user_demand">[docs]</a>
    <span class="k">def</span> <span class="nf">handle_user_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand_id</span><span class="p">,</span> <span class="n">demand_uid</span><span class="p">,</span> <span class="n">judgement</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode fait suite à la décision d&#39;un admin concernant la demande d&#39;un utilisateur pour rejoindre un salon.</span>

<span class="sd">        :param demand_id: ID de la demande traitée</span>
<span class="sd">        :type demand_id: int</span>

<span class="sd">        :param demand_uid: ID de l&#39;utilisateur que la demande concerne.</span>
<span class="sd">        :type demand_uid: int</span>

<span class="sd">        :param judgement: Décision de l&#39;admin concernant la demande.</span>
<span class="sd">        :type judgement: str (OK / NOK)</span>

<span class="sd">        :ivar message: Message envoyé au serveur par l&#39;admin (/change_user_room_rights ID Demande|ID utilisateur|Décision)</span>
<span class="sd">        :vartype message: str</span>

<span class="sd">        .. note::</span>

<span class="sd">            Cette méthode ne peut pas être appelée par un utilisateur lambda.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle handle_user_demand starts]&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing demand : </span><span class="si">{</span><span class="n">demand_id</span><span class="si">}</span><span class="s2"> for uid : </span><span class="si">{</span><span class="n">demand_uid</span><span class="si">}</span><span class="s2"> with result </span><span class="si">{</span><span class="n">judgement</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/change_user_room_right </span><span class="si">{</span><span class="n">demand_id</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">demand_uid</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">judgement</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle handle_user_demand ends]&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Client_handle.handle_friend_request">
<a class="viewcode-back" href="../client.html#client.Client_handle.handle_friend_request">[docs]</a>
    <span class="k">def</span> <span class="nf">handle_friend_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand_from</span><span class="p">,</span> <span class="n">judgement</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode fait suite à la décision d&#39;un utilisateur concernant une demande d&#39;ami qui lui a été faite.</span>

<span class="sd">        :param demand_from: ID de l&#39;utilisateur ayant soumis la demande d&#39;ami.</span>
<span class="sd">        :type demand_from: int</span>

<span class="sd">        :param judgement: Décision de l&#39;utilisateur concernant la demande dami.</span>
<span class="sd">        :type judgement: str (OK / NOK)</span>

<span class="sd">        :ivar message: Message envoyé au serveur par l&#39;admin (/accept_friend_request ID demandeur|ID demandé|Décision)</span>
<span class="sd">        :vartype message: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle handle_friend_request starts]&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing friend request from </span><span class="si">{</span><span class="n">demand_from</span><span class="si">}</span><span class="s2"> with result : </span><span class="si">{</span><span class="n">judgement</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/accept_friend_request </span><span class="si">{</span><span class="n">demand_from</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">judgement</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle handle_friend_request ends]&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client_handle.append_message_to_room">
<a class="viewcode-back" href="../client.html#client.Client_handle.append_message_to_room">[docs]</a>
    <span class="k">def</span> <span class="nf">append_message_to_room</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cette méthode ajoute les nouveaux messages reçus à la salle associée.</span>

<span class="sd">        :param data: Paquet content le message reçu</span>
<span class="sd">        :type data: str</span>

<span class="sd">        :ivar username: Nom de l&#39;utilisateur ayant envoyé le message</span>
<span class="sd">        :vartype username: str</span>

<span class="sd">        :ivar datetime: Date &amp; Heure d&#39;envoi du message</span>
<span class="sd">        :vartype datetime: datatime</span>

<span class="sd">        :ivar message: Contenu du message</span>
<span class="sd">        :vartype message: str</span>

<span class="sd">        :raises Exception: Si le message reçu est incohérent ou bien si celui-ci n&#39;a pas pu être ajouté à la salle de chat.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle append_message_to_room starts]&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message data to sort and appen to text area : </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">datetime</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;§&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;splitting ok&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Messages_display</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">datetime</span><span class="si">}</span><span class="s2">] -&gt; </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;append ok&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR DURING APPENDING THE MESSAGE TO THE QTextEdit&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle append_message_to_room ends]&quot;</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Client_handle append_message_to_room ends]&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR DURING &#39;append_message_to_room&#39;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">)</span></div>
</div>


    







</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Owen PICHOT
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=fc40adec"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/translations.js?v=d99ca74e"></script>
    </body>
</html>